<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV | Đặng Văn Thanh - Unity Game Programmer</title>
    <link rel="icon" href="ava.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"
          rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body class="antialiased text-slate-800">

<!-- Control Panel -->
<div class="no-print flex items-center gap-3">
    <button onclick="window.print()" class="action-btn" type="button">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
        </svg>
        Save PDF
    </button>
    <button onclick="window.open('portfolio.html', '_blank')" class="action-btn" type="button">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M3 7a2 2 0 012-2h4l2 2h6a2 2 0 012 2v7a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/>
        </svg>
        Portfolio
    </button>
</div>

<!-- Main CV Content -->
<div id="cv-content" class="cv-container mx-auto bg-white shadow-sm my-8 min-h-screen">

    <!-- HEADER -->
    <header class="p-8 sm:px-12 pt-12 pb-8 border-b border-slate-100 mb-8">
        <h1 id="fullName" class="text-5xl font-medium text-slate-900 tracking-tight leading-tight mb-2"></h1>
        <p id="jobTitle" class="text-sm font-medium text-sky-700 uppercase tracking-widest"></p>
    </header>

    <!-- WRAPPER -->
    <div class="flex flex-col md:flex-row px-8 sm:px-12 pb-12 gap-10">

        <!-- LEFT COLUMN (Main: 66%) -->
        <main class="w-full md:w-2/3">
            <!-- Mobile Contact -->
            <section class="mb-8 md:hidden mobile-order-1">
                <h2 class="section-title" id="title-contact-mobile"></h2>
                <ul class="space-y-2 text-sm text-slate-600" id="contact-container-mobile"></ul>
            </section>

            <!-- About -->
            <section class="mb-8 mobile-order-2 section-container">
                <h2 class="section-title" id="title-about"></h2>
                <p id="about" class="text-slate-600 text-sm leading-relaxed text-left"></p>
            </section>

            <!-- Work Experience -->
            <section class="mb-8 mobile-order-4 section-container">
                <h2 class="section-title" id="title-experience"></h2>
                <div class="space-y-6" id="work-experience-container"></div>
            </section>

            <!-- Projects -->
            <section class="mobile-order-5 section-container">
                <h2 class="section-title" id="title-projects"></h2>
                <div class="space-y-5" id="projects-container"></div>
            </section>
        </main>

        <!-- RIGHT COLUMN (Sidebar: 34%) -->
        <aside class="w-full md:w-1/3">
            <!-- Desktop Contact -->
            <section class="mb-8 hidden md:block section-container">
                <h2 class="section-title" id="title-contact"></h2>
                <ul class="space-y-3 text-sm text-slate-600" id="contact-container"></ul>
            </section>

            <!-- Education -->
            <section class="mb-8 mobile-order-6 md:order-none section-container">
                <h2 class="section-title" id="title-education"></h2>
                <div id="education-container"></div>
            </section>

            <!-- Skills -->
            <section class="mb-8 mobile-order-3 md:order-none section-container">
                <h2 class="section-title" id="title-skills"></h2>
                <div id="skills-container" class="space-y-4"></div>
            </section>

            <!-- Mobile Skills -->
            <div id="skills-container-mobile" class="md:hidden space-y-4"></div>
        </aside>
    </div>
</div>

<script src="data.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Helper 1: Gán Text an toàn (Đã có)
        const setText = (id, text) => {
            const el = document.getElementById(id);
            if (el) el.textContent = text;
        };

        // Helper 2: Gán HTML an toàn (MỚI THÊM)
        // Hàm này sẽ kiểm tra xem id có tồn tại không rồi mới gán innerHTML
        const setHtml = (id, html) => {
            const el = document.getElementById(id);
            if (el) el.innerHTML = html;
        };

        // Helper 3: Tạo HTML Link
        const generateLinkHtml = (link, text) => {
            if (!link) return '';
            return `
                <li class="mt-0.5 no-bullet">
                    <a href="${link}" target="_blank" class="text-sky-700 hover:underline font-semibold inline-flex items-center gap-1">
                        ${text || 'Xem chi tiết'}
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                        </svg>
                    </a>
                </li>
            `;
        };

        // --- BẮT ĐẦU GÁN DỮ LIỆU ---

        // 1. Set Headers
        setText('title-about', cvData.sectionTitles.about);
        setText('title-experience', cvData.sectionTitles.workExperience);
        setText('title-projects', cvData.sectionTitles.personalProjects);
        setText('title-contact', cvData.sectionTitles.contact);
        setText('title-contact-mobile', cvData.sectionTitles.contact);
        setText('title-education', cvData.sectionTitles.education);
        setText('title-skills', cvData.sectionTitles.skills);
        setText('title-skills-mobile', cvData.sectionTitles.skills);

        // 2. Basic Info
        setText('fullName', cvData.fullName);
        setText('jobTitle', cvData.jobTitle);
        
        // SỬA LỖI Ở ĐÂY: Dùng setHtml thay vì gọi trực tiếp .innerHTML
        setHtml('about', cvData.about);

        // 3. Icons & Contact
        const icons = {
            phone: `<svg class="w-4 h-4 text-sky-700 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>`,
            email: `<svg class="w-4 h-4 text-sky-700 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>`,
            location: `<svg class="w-4 h-4 text-sky-700 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>`,
            web: `<svg class="w-4 h-4 text-sky-700 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/></svg>`,
            github: `<svg class="w-4 h-4 text-sky-700 shrink-0" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"/></svg>`
        };

        const contactHTML = `
            <li class="flex items-center gap-2">${icons.phone} <span>${cvData.contact.phone}</span></li>
            <li class="flex items-center gap-2">${icons.email} <a href="mailto:${cvData.contact.email}">${cvData.contact.email}</a></li>
            <li class="flex items-center gap-2">${icons.web} <a href="${cvData.contact.website}" target="_blank">${cvData.contact.websiteDisplay}</a></li>
            <li class="flex items-center gap-2">${icons.github} <a href="${cvData.contact.github}" target="_blank">${cvData.contact.githubDisplay}</a></li>
            <li class="flex items-start gap-2"><span class="mt-0.5">${icons.location}</span> <span>${cvData.contact.address}</span></li>
        `;

        // SỬA LỖI Ở ĐÂY: Dùng setHtml
        setHtml('contact-container', contactHTML);
        setHtml('contact-container-mobile', contactHTML);

        // 4. Education
        const eduHTML = `
            <div>
                <h3 class="font-bold text-slate-900 text-sm mb-1">${cvData.education.school}</h3>
                <p class="text-slate-600 text-sm mb-1">${cvData.education.major}</p>
                <span class="text-xs text-slate-400 font-medium">${cvData.education.period}</span>
            </div>
        `;
        // SỬA LỖI Ở ĐÂY: Dùng setHtml
        setHtml('education-container', eduHTML);

        // 5. Work Experience
        const workContainer = document.getElementById('work-experience-container');
        if (workContainer && cvData.workExperience) {
            cvData.workExperience.forEach(work => {
                let mainContentHtml = '';

                if (work.description) {
                    if (Array.isArray(work.description)) {
                        mainContentHtml += `<div class="mb-3 space-y-1 text-sm text-slate-600 italic leading-relaxed">
                            ${work.description.map(d => `<p>${d}</p>`).join('')}
                        </div>`;
                    } else {
                        mainContentHtml += `<p class="mb-3 text-xs text-slate-600 italic leading-relaxed">${work.description}</p>`;
                    }
                }

                if (Array.isArray(work.details) && work.details.length > 0) {
                    const limit = (work.maxProjects !== undefined) ? work.maxProjects : 2;
                    const visibleDetails = work.details.slice(0, limit);

                    mainContentHtml += `<div class="mt-3 space-y-4">
                        ${visibleDetails.map(p => `
                            <div class="relative pl-4 border-l-2 border-slate-200">
                                <div class="mb-1">
                                    <h4 class="font-bold text-slate-800 text-sm inline-block mr-2">${p.name}</h4>
                                    <span class="text-xs text-slate-500 italic font-medium">${p.genre}</span>
                                </div>
                                ${p.description ? `<p class="mb-2 text-sm text-slate-600 italic leading-relaxed">${p.description}</p>` : ''}
                                <ul class="list-disc list-outside ml-4 text-sm text-slate-600 space-y-1 marker:text-slate-400">
                                    ${p.points.map(pt => `<li>${pt}</li>`).join('')}
                                    ${generateLinkHtml(p.link, p.linkText)}
                                </ul>
                            </div>
                        `).join('')}
                    </div>`;

                    const totalProjects = work.details.length;
                    if (work.moreProjectsLink || totalProjects > limit) {
                        const targetLink = work.moreProjectsLink || 'portfolio.html';
                        mainContentHtml += `
                            <div class="mt-2 pl-4 text-xs">
                                <a href="${targetLink}" target="_blank" class="text-sky-600 hover:underline italic flex items-center gap-1">
                                    + Xem thêm các dự án khác...
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                                </a>
                            </div>
                        `;
                    }
                }

                workContainer.innerHTML += `
                    <div class="relative job-entry">
                        <div class="flex justify-between items-baseline mb-1">
                            <h3 class="font-bold text-base text-slate-900">${work.company}</h3>
                            <span class="text-xs font-mono text-slate-500 whitespace-nowrap">${work.period}</span>
                        </div>
                        <p class="text-sm font-semibold text-sky-700 mb-2">${work.title}</p>
                        ${mainContentHtml}
                    </div>
                `;
            });
        }

        // 6. Projects (CV Version)
        const projectsContainer = document.getElementById('projects-container');
        if (projectsContainer && cvData.personalProjects && cvData.personalProjects.projects) {
            // ... (Logic cũ của bạn, phần này OK vì đã có kiểm tra if projectsContainer)
            const personalLimit = (cvData.personalProjects.maxProjects !== undefined) ? cvData.personalProjects.maxProjects : 3;
            const visiblePersonalProjects = cvData.personalProjects.projects.slice(0, personalLimit);

            visiblePersonalProjects.forEach(project => {
                projectsContainer.innerHTML += `
                    <div class="project-entry relative pl-4 border-l-2 border-slate-200">
                        <div class="flex justify-between items-baseline mb-1">
                            <div>
                                <h3 class="font-bold text-slate-800 text-sm inline-block mr-2">${project.name}</h3>
                                <span class="text-xs text-slate-500 italic font-medium">${project.genre}</span>
                            </div>
                            <span class="text-xs font-mono text-slate-500 whitespace-nowrap ml-4">${project.period}</span>
                        </div>
                        ${project.description ? `<p class="mb-2 text-sm text-slate-600 italic leading-relaxed">${project.description}</p>` : ''}
                        <ul class="list-disc list-outside ml-4 text-sm text-slate-600 space-y-1 marker:text-slate-400">
                            ${project.points.map(d => `<li>${d}</li>`).join('')}
                            ${generateLinkHtml(project.link, project.linkText)}
                        </ul>
                    </div>
                `;
            });
            
            const totalProjects = cvData.personalProjects.projects.length;
            const hasMoreLink = cvData.personalProjects.moreProjectsLink;
            if (hasMoreLink || totalProjects > personalLimit) {
                const targetLink = hasMoreLink || 'portfolio.html#TechnicalR&D';
                projectsContainer.innerHTML += `
                    <div class="mt-2 pl-4 text-xs">
                        <a href="${targetLink}" target="_blank" class="text-sky-600 hover:underline italic flex items-center gap-1">
                            + Xem thêm các dự án khác...
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                        </a>
                    </div>
                `;
            }
        }

        // 7. Skills
        const renderSkills = (containerId) => {
            const container = document.getElementById(containerId);
            if (!container) return; // Đã an toàn
            cvData.skills.forEach((group, index) => {
                const colorClasses = index === 0
                    ? 'bg-sky-100 text-sky-800'
                    : 'bg-slate-200 text-slate-700';

                const tags = group.items.map(s => `<span class="${colorClasses} text-xs font-semibold px-3 py-1 rounded-full">${s}</span>`).join('');
                container.innerHTML += `
                    <div class="mb-4 skill-group">
                        <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">${group.category}</h4>
                        <div class="flex flex-wrap gap-2">${tags}</div>
                    </div>
                `;
            });
        };
        renderSkills('skills-container');

        function hexToRgba(hex, alpha) {
            let c;
            if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)){
                c= hex.substring(1).split('');
                if(c.length== 3){
                    c= [c[0], c[0], c[1], c[1], c[2], c[2]];
                }
                c= '0x'+c.join('');
                return 'rgba('+[(c>>16)&255, (c>>8)&255, c&255].join(',')+','+alpha+')';
            }
            return hex;
        }

        function injectDynamicStyles() {
            const styleId = 'dynamic-theme-styles';
            if (!document.getElementById(styleId)) {
                const style = document.createElement('style');
                style.id = styleId;
                style.innerHTML = `
                    /* Static Colors */
                    .text-theme { color: var(--theme-color) !important; }
                    .bg-theme { background-color: var(--theme-color) !important; }
                    .bg-theme-light { background-color: var(--theme-light) !important; }
                    .border-theme-light { border-color: var(--theme-light) !important; }
                    
                    /* Hover States */
                    .hover-border-theme:hover { border-color: var(--theme-color) !important; }
                    
                    .group:hover .group-hover-text-theme { color: var(--theme-color) !important; }
                    .group:hover .group-hover-bg-theme-light { background-color: var(--theme-light) !important; }
                `;
                document.head.appendChild(style);
            }
        }
    });
</script>
</body>
</html>