<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio | Đặng Văn Thanh - Unity Game Programmer</title>
    <link rel="icon" href="ava.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f8fafc;
            color: #334155;
            -webkit-font-smoothing: antialiased;
        }

        .project-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #e2e8f0;
        }

        .project-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 20px -5px rgba(0, 0, 0, 0.08);
            border-color: #bae6fd;
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

<nav class="bg-white border-b border-slate-200 sticky top-0 z-[100]">
    <div class="max-w-6xl mx-auto px-4 h-16 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <img src="ava.png" alt="Avatar" class="w-10 h-10 rounded-lg object-cover border border-sky-700">
            <div>
                <h1 id="nav-name" class="font-bold text-slate-900 text-sm md:text-base leading-none"></h1>
                <span id="nav-title"
                      class="text-[9px] text-slate-400 font-bold tracking-[0.2em] uppercase mt-1 block"></span>
            </div>
        </div>
        <div class="flex items-center gap-6">
            <a href="index.html" target="_blank" title="My CV" class="header-link font-bold inline-flex flex-row items-center gap-2 whitespace-nowrap text-sm text-slate-500 hover:text-sky-700 transition tracking-widest uppercase">
                <span class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="svg-icon" viewBox="0 0 16 16" width="20">
                        <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm9 1.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 0-1h-4a.5.5 0 0 0-.5.5M9 8a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 0-1h-4A.5.5 0 0 0 9 8m1 2.5a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 0-1h-3a.5.5 0 0 0-.5.5m-1 2C9 10.567 7.21 9 5 9c-2.086 0-3.8 1.398-3.984 3.181A1 1 0 0 0 2 13h6.96q.04-.245.04-.5M7 6a2 2 0 1 0-4 0 2 2 0 0 0 4 0"></path>
                    </svg>
                </span>
                <span>My CV</span>
            </a>
        </div>
    </div>
</nav>

<header class="bg-white pb-10 pt-14 px-4 text-center border-b border-slate-50">
    <h2 id="hero-title" class="text-3xl font-bold text-slate-900 mb-3 tracking-tight"></h2>
    <p id="hero-subtitle" class="text-slate-500 text-sm max-w-xl mx-auto leading-relaxed"></p>
    <!--    <div class="flex flex-wrap justify-center gap-2 mt-6" id="hero-skills"></div>-->
</header>

<main id="main-content" class="max-w-6xl mx-auto px-4 py-12 w-full flex-grow space-y-16">
</main>

<footer class="bg-white border-t border-slate-200 py-8">
    <div class="max-w-6xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4">
        <p id="footer-copy" class="text-slate-400 text-[13px] tracking-widest uppercase"></p>

        <div id="footer-socials" class="flex gap-6 text-slate-400 items-center">
        </div>
    </div>
</footer>

<div id="project-modal" class="fixed inset-0 z-[200] hidden items-center justify-center p-4 sm:p-8 transition-opacity duration-300 opacity-0 pointer-events-none" aria-hidden="true">
    
    <div class="absolute inset-0 bg-slate-50/80 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
    
    <div id="modal-animation-wrapper" class="relative w-full max-w-5xl z-10 transform scale-95 opacity-0 transition-all duration-300 ease-out">
        
        <button onclick="closeModal()" class="absolute top-2 right-3 md:-top-5 md:-right-5 p-2 bg-white text-slate-900 hover:bg-slate-100 rounded-full transition-all z-50 shadow-lg border border-slate-200 hover:scale-110 hover:rotate-90 duration-300">
            <i data-lucide="x" class="w-6 h-6"></i>
        </button>

        <div id="modal-content" class="bg-white w-full max-h-[85vh] sm:max-h-[90vh] rounded-2xl overflow-hidden shadow-2xl flex flex-col border border-slate-200">
            <div class="overflow-y-auto custom-scrollbar flex-grow">
                
                <div id="modal-media-section" class="w-full bg-white flex flex-col border-b border-slate-100">
                    
                    <div id="modal-main-media" class="w-full aspect-video flex items-center justify-center bg-slate-50 overflow-hidden relative">
                        </div>

                    <div class="w-full py-4 border-t border-slate-100 bg-white">
                        <div class="w-full px-2 md:px-8 flex items-center gap-2 md:gap-4">
                            
                            <button onclick="scrollThumbnails(-1)" class="flex-shrink-0 p-2 rounded-full text-slate-400 hover:text-sky-600 hover:bg-slate-100 transition-colors">
                                <i data-lucide="chevron-left" class="w-6 h-6"></i>
                            </button>

                            <div id="modal-thumbnails" class="flex-1 flex gap-3 overflow-x-auto custom-scrollbar scroll-smooth justify-start p-2">
                                </div>

                            <button onclick="scrollThumbnails(1)" class="flex-shrink-0 p-2 rounded-full text-slate-400 hover:text-sky-600 hover:bg-slate-100 transition-colors">
                                <i data-lucide="chevron-right" class="w-6 h-6"></i>
                            </button>

                        </div>
                    </div>
                </div>

                <div class="p-6 pt-14 md:p-8">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-4 mb-6 border-b border-slate-100 pb-6">
                        
                        <div>
                            <h2 id="modal-title" class="text-3xl font-bold text-slate-900 mb-2"></h2>
                            <div id="modal-genre" class="text-sky-700 font-bold uppercase tracking-widest text-xs"></div>
                        </div>

                        <div id="modal-links" class="flex gap-3"></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="md:col-span-2 space-y-6">
                            <div>
                                <h3 class="font-bold text-slate-900 text-sm uppercase tracking-wide mb-2 flex items-center gap-2"><i data-lucide="info" class="w-4 h-4 text-sky-600"></i> Mô tả</h3>
                                <p id="modal-desc" class="text-slate-600 text-sm leading-relaxed"></p>
                            </div>
                            <div>
                                <h3 class="font-bold text-slate-900 text-sm uppercase tracking-wide mb-2 flex items-center gap-2"><i data-lucide="cpu" class="w-4 h-4 text-sky-600"></i> Chi tiết kỹ thuật</h3>
                                <ul id="modal-points" class="list-disc ml-5 space-y-2 text-slate-600 leading-relaxed text-sm"></ul>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <h3 class="font-bold text-slate-900 text-sm uppercase tracking-wide mb-2 flex items-center gap-2"><i data-lucide="code-2" class="w-4 h-4 text-sky-600"></i> Công nghệ</h3>
                            <div id="modal-tags" class="flex flex-wrap gap-2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="data.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        initBasicInfo();
        renderFooterContacts();
        // renderHeroSkills();
        renderDynamicSections();
        lucide.createIcons();

        setTimeout(() => {
            initCarouselState();
        }, 100);

        if (window.location.hash) {
            const targetId = window.location.hash.substring(1);
            const element = document.getElementById(targetId);
            if (element) {
                setTimeout(() => {
                    element.scrollIntoView({behavior: 'smooth'});
                }, 100);
            }
        }

        document.querySelectorAll('.no-scrollbar').forEach(el => {
            el.style.msOverflowStyle = 'none';
            el.style.scrollbarWidth = 'none';
        });

        window.addEventListener('resize', () => {
            setTimeout(initCarouselState, 100);
        });
    });

    // 1. Điền thông tin cơ bản & Header
    function initBasicInfo() {
        document.getElementById('nav-name').textContent = cvData.fullName;
        document.getElementById('nav-title').textContent = cvData.jobTitle;

        const pfInfo = cvData.portfolioInfo || {
            title: "Danh mục dự án",
            subTitle: "Tổng hợp các sản phẩm Game Mobile và dự án nghiên cứu kỹ thuật cá nhân trong quá trình làm việc.",
            footerText: "© 2026 Đặng Văn Thanh"
        };

        document.getElementById('hero-title').textContent = pfInfo.title;
        document.getElementById('hero-subtitle').textContent = pfInfo.subTitle;
        document.getElementById('footer-copy').textContent = pfInfo.footerText;
    }

    // 2. Render Footer Icons
    function renderFooterContacts() {
        const container = document.getElementById('footer-socials');
        const c = cvData.contact;

        const socialItems = [
            {icon: 'phone', link: `tel:${c.phone}`, title: c.phone},
            {icon: 'mail', link: `mailto:${c.email}`, title: c.email},
            {icon: 'globe', link: c.website, title: c.websiteDisplay},
            {icon: 'github', link: c.github, title: c.githubDisplay},
            {
                icon: 'map-pin',
                link: `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(c.address)}`,
                title: c.address
            }
        ];

        socialItems.forEach(item => {
            if (item.link && !item.link.includes('undefined')) {
                const a = document.createElement('a');
                a.href = item.link;
                a.target = "_blank";
                a.className = "hover:text-sky-700 transition transform hover:scale-110";
                a.title = item.title;

                const i = document.createElement('i');
                i.setAttribute('data-lucide', item.icon);
                i.className = "w-5 h-5";

                a.appendChild(i);
                container.appendChild(a);
            }
        });
    }

    // 3. Render Tags kỹ năng trên Header
    function renderHeroSkills() {
        const heroSkills = document.getElementById('hero-skills');
        cvData.skills.flatMap(s => s.items).forEach(item => {
            heroSkills.innerHTML += `<span class="px-2.5 py-1 bg-slate-50 text-slate-500 text-[10px] font-bold rounded-md border border-slate-100 uppercase tracking-tighter">${item}</span>`;
        });
    }

    // 4. Hàm chính: Tự động tạo Section theo Công ty & Cá nhân
    function renderDynamicSections() {
        const mainContainer = document.getElementById('main-content');

        // B. Render Dự án cá nhân
        if (cvData.personalProjects && cvData.personalProjects.projects.length > 0) {
            const title = cvData.portfolioInfo?.personalSectionTitle || "Personal Projects";
            // Lấy màu từ data, nếu không có thì dùng mặc định Sky Blue
            const color = cvData.personalProjects.theme || "#0369a1"; 
            
            const sectionHtml = generateSectionHtml(
                title,
                'code-2',
                cvData.personalProjects.projects,
                color // Truyền mã màu
            );
            mainContainer.insertAdjacentHTML('beforeend', sectionHtml);
        }

        // A. Render từng công ty trong Work Experience
        cvData.workExperience.forEach(work => {
            if (work.details && work.details.length > 0) {
                // Lấy màu từ data, nếu không có thì dùng mặc định Slate (cho giống cũ) hoặc Sky
                const color = work.theme || "#0369a1"; 

                const sectionHtml = generateSectionHtml(
                    work.company,
                    'briefcase',
                    work.details,
                    color // Truyền mã màu
                );
                mainContainer.insertAdjacentHTML('beforeend', sectionHtml);
            }
        });
    }

// Helper: Hàm sinh HTML cho một Section
    function generateSectionHtml(title, iconName, projects, themeColor) {
        // Tạo ID an toàn
        const sectionId = title.replace(/\s+/g, '');

        const cardsHtml = projects.map(proj => `
        <div class="w-[85vw] md:w-[380px] flex-shrink-0 snap-start h-full">
            ${renderCard(proj, title === "Technical R&D" ? "ThanhDV" : title, themeColor)}
        </div>
    `).join('');

        return `
        <section id="${sectionId}" class="scroll-mt-24 mb-12">
            <div class="flex items-center justify-between mb-0 px-1">

                <div class="flex items-center gap-3">
                    <i data-lucide="${iconName}" style="color: ${themeColor}" class="w-6 h-6"></i>
                    <h3 class="text-xl font-bold text-slate-900 uppercase tracking-wider">${title}</h3>
                </div>

                <div class="flex gap-2 translate-y-[12px]">
                    <button id="btn-left-${sectionId}"
                            onclick="handleScroll('${sectionId}', -1)"
                            class="flex items-center justify-center w-10 h-10 rounded-full
                                   border border-slate-300 bg-white text-slate-500
                                   hover:bg-slate-50 transition-all duration-200 shadow-md cursor-pointer"
                            style="opacity: 0.5; pointer-events: none;"> 
                            <i data-lucide="chevron-left" class="w-5 h-5"></i>
                    </button>

                    <button id="btn-right-${sectionId}"
                            onclick="handleScroll('${sectionId}', 1)"
                            class="flex items-center justify-center w-10 h-10 rounded-full
                                   border border-slate-300 bg-white text-slate-500
                                   hover:bg-slate-50 transition-all duration-200 shadow-md cursor-pointer">
                        <i data-lucide="chevron-right" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>

            <div class="relative w-full group">
                <div id="container-${sectionId}"
                     onscroll="updateButtonVisibility('${sectionId}')"
                     class="flex gap-6 overflow-x-auto no-scrollbar snap-x snap-mandatory scroll-smooth px-1 py-4 w-full h-full scroll-pl-1 relative z-10">
                    ${cardsHtml}
                </div>
            </div>
        </section>
    `;
    }

    // Helper: Hàm sinh HTML cho từng Card dự án
    function renderCard(proj, subtitle, themeColor) {
        // Fallback màu nếu bị thiếu
        const color = themeColor || '#0369a1';
        
        // Tạo các biến màu từ mã hex chính
        // Thêm '1a' vào cuối hex 6 ký tự để tạo độ trong suốt ~10% (cho background)
        // Thêm '33' để tạo độ trong suốt ~20% (cho border nhạt)
        const bgStyle = `background-color: ${color}1a; color: ${color}; border-color: ${color}33;`;
        const textStyle = `color: ${color};`;
        const borderTopStyle = `background-color: ${color};`;

        const tags = proj.tags?.map(t =>
            // Áp dụng style màu động cho Tags (thay vì bg-sky-50...)
            `<span style="${bgStyle}" class="text-[10px] font-bold px-1.5 py-0.5 rounded border uppercase tracking-tighter">${t}</span>`
        ).join('') || '';

        const points = proj.points?.map(p =>
            `<li class="mb-1 text-[13px] leading-snug">${p}</li>`
        ).join('') || '';

        // Logic Icon/Ảnh
        const iconValue = proj.icon || (subtitle === "Personal Project" ? 'code' : 'gamepad-2');
        const isImagePath = iconValue.includes('/') || iconValue.includes('.');
        const iconSize = '64px'; 
        
        let iconHtml;
        if (isImagePath) {
            iconHtml = `
                <img src="${iconValue}" 
                     alt="${proj.name}" 
                     onerror="this.style.display='none'"
                     style="width: ${iconSize}; height: ${iconSize}; border-radius: 12px;"
                     class="object-cover border border-slate-100 shadow-sm bg-white shrink-0">
            `;
        } else {
            // Áp dụng màu động cho Icon Lucide (thay vì bg-slate-50...)
            iconHtml = `
                <div style="width: ${iconSize}; height: ${iconSize}; ${bgStyle} border-radius: 12px;"
                     class="flex items-center justify-center transition-colors shrink-0">
                    <i data-lucide="${iconValue}" class="w-7 h-7"></i>
                </div>
            `;
        }

        // Script nhỏ inline để xử lý hover cho Title (vì inline style không hỗ trợ :hover)
        const hoverTitleScript = `onmouseover="this.style.color='${color}'" onmouseout="this.style.color=''"`;

        return `
            <div onclick="openProjectModal('${proj.name}')"
                 class="project-card bg-white rounded-xl p-6 h-full flex flex-col relative group cursor-pointer border border-slate-200 hover:shadow-lg transition-all duration-300"
                 style="border-color: #e2e8f0;" 
                 onmouseover="this.style.borderColor='${color}40'" 
                 onmouseout="this.style.borderColor='#e2e8f0'">

                <div style="${borderTopStyle}" class="absolute top-0 left-0 w-full h-1 rounded-t-xl transition-all group-hover:h-1.5"></div>

                <div class="flex items-start gap-4 mb-3">
                    ${iconHtml}
                    
                    <div class="flex-grow min-w-0 pt-0.5">
                        <div class="flex justify-between items-start">
                            <h4 ${hoverTitleScript} class="text-base font-bold text-slate-900 leading-tight transition-colors line-clamp-2 pr-1">
                                ${proj.name}
                            </h4>
                            <span class="text-[9px] font-bold text-slate-400 uppercase tracking-[0.15em] text-right shrink-0 mt-0.5 ml-2">${subtitle}</span>
                        </div>
                        <div style="${textStyle}" class="text-[10px] font-bold mt-1.5 italic tracking-tight uppercase">${proj.genre || ''}</div>
                    </div>
                </div>

                <p class="text-slate-600 text-[13px] font-medium leading-relaxed mb-4 line-clamp-2">
                    ${proj.description}
                </p>

                <ul class="text-slate-500 list-disc list-outside ml-4 mb-6 flex-grow font-normal leading-snug">
                    ${points}
                </ul>

                <div class="flex flex-wrap gap-1.5 pt-4 border-t border-slate-50">
                    ${tags}
                </div>

                <div class="absolute bottom-4 right-4 text-slate-200 transition-colors"
                     onmouseover="this.style.color='${color}'" 
                     onmouseout="this.style.color='rgb(226 232 240)'"> <i data-lucide="maximize-2" class="w-3 h-3"></i>
                </div>
            </div>`;
    }

    // 1. Xử lý sự kiện click
    function handleScroll(id, direction) {
        const container = document.getElementById(`container-${id}`);
        if (container) {
            const scrollAmount = container.clientWidth * 0.75;
            container.scrollBy({left: direction * scrollAmount, behavior: 'smooth'});
        }
    }

    // 2. Logic Ẩn/Hiện (Chạy mỗi khi cuộn)
    // (Code này giữ nguyên từ bước trước, dán lại để đảm bảo đồng bộ)
    function updateButtonVisibility(id) {
        const container = document.getElementById(`container-${id}`);
        const btnLeft = document.getElementById(`btn-left-${id}`);
        const btnRight = document.getElementById(`btn-right-${id}`);

        if (!container || !btnLeft || !btnRight) return;

        // Nút Trái
        if (container.scrollLeft <= 10) {
            btnLeft.style.opacity = '0.5';
            btnLeft.style.pointerEvents = 'none';
            btnLeft.style.transform = 'translateY(-50%) scale(0.8)'; // Hiệu ứng thu nhỏ khi ẩn
        } else {
            btnLeft.style.opacity = '1';
            btnLeft.style.pointerEvents = 'auto';
            btnLeft.style.transform = 'translateY(-50%) scale(1)'; // Trở lại bình thường
        }

        // Nút Phải
        const scrollRight = Math.ceil(container.scrollLeft + container.clientWidth);
        const scrollWidth = Math.ceil(container.scrollWidth);

        if (scrollRight >= scrollWidth - 10) {
            btnRight.style.opacity = '0.5';
            btnRight.style.pointerEvents = 'none';
            btnRight.style.transform = 'translateY(-50%) scale(0.8)';
        } else {
            btnRight.style.opacity = '1';
            btnRight.style.pointerEvents = 'auto';
            btnRight.style.transform = 'translateY(-50%) scale(1)';
        }
    }

    // 3. Khởi tạo (Chạy 1 lần khi load trang)
    function initCarouselState() {
        const containers = document.querySelectorAll('[id^="container-"]');

        containers.forEach(container => {
            const id = container.id.replace('container-', '');

            // --- FIX QUAN TRỌNG: ÉP VỀ VỊ TRÍ 0 ---
            // Sửa lỗi trình duyệt tự nhớ vị trí cũ hoặc snap sai
            container.scrollLeft = 0;
            // -------------------------------------

            // Kiểm tra xem nội dung có đủ dài để cuộn không
            if (container.scrollWidth <= container.clientWidth + 5) {
                // Nếu ngắn quá -> Ẩn luôn nút phải
                const btnRight = document.getElementById(`btn-right-${id}`);
                if (btnRight) {
                    btnRight.style.opacity = '0';
                    btnRight.style.pointerEvents = 'none';
                }
            } else {
                // Nếu đủ dài -> Cập nhật trạng thái (lúc này nút trái sẽ ẩn vì scrollLeft = 0)
                updateButtonVisibility(id);
            }
        });
    }

    // --- LOGIC MODAL & MEDIA ---

    // Hàm helper để tìm dự án trong data
    function findProjectData(projectName) {
        // Tìm trong Work Experience
        for (const work of cvData.workExperience) {
            const found = work.details?.find(p => p.name === projectName);
            if (found) return found;
        }
        // Tìm trong Personal Projects
        if (cvData.personalProjects?.projects) {
            return cvData.personalProjects.projects.find(p => p.name === projectName);
        }
        return null;
    }

    // Hàm chuyển đổi link Youtube thường thành link Embed
    function getYoutubeEmbedUrl(url) {
        if (!url) return '';
        const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
        const match = url.match(regExp);
        return (match && match[2].length === 11) ? `https://www.youtube.com/embed/${match[2]}` : url;
    }

    function openProjectModal(projectName) {
        // ... (Giữ nguyên phần logic tìm data và điền text/media ở đây) ...
        const project = findProjectData(projectName);
        if (!project) return;
        // Fill Text Data...
        document.getElementById('modal-title').textContent = project.name;
        document.getElementById('modal-genre').textContent = project.genre || 'Project';
        document.getElementById('modal-desc').textContent = project.description || '';
        document.getElementById('modal-points').innerHTML = project.points?.map(p => `<li>${p}</li>`).join('') || '';
        document.getElementById('modal-tags').innerHTML = project.tags?.map(t => `<span class="px-3 py-1 bg-slate-100 text-slate-600 text-xs font-semibold rounded border border-slate-200">${t}</span>`).join('') || '';

        const linksContainer = document.getElementById('modal-links');
        let linksHtml = '';
        if (project.link) {
            linksHtml += `
                <a href="${project.link}" target="_blank" class="flex items-center gap-2 px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white text-sm font-bold rounded-lg transition-all shadow-md hover:shadow-lg">
                    <span>${project.linkText || 'Xem Project'}</span>
                    <i data-lucide="external-link" class="w-4 h-4"></i>
                </a>
            `;
        }
        if (project.backupLink) {
            linksHtml += `
                <a href="${project.backupLink}" class="flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-bold rounded-lg transition-all shadow-md hover:shadow-lg">
                    <span>${project.backupLinkText || 'Download'}</span>
                    <i data-lucide="download" class="w-4 h-4"></i>
                </a>
            `;
        }
        linksContainer.innerHTML = linksHtml;

        // Fill Media Data...
        const mediaList = [];
        if (project.videos) project.videos.forEach(v => mediaList.push({ type: 'video', src: v }));
        if (project.images) project.images.forEach(img => mediaList.push({ type: 'image', src: img }));
        renderMediaPlayer(mediaList, project);
        // ... (Kết thúc phần logic data) ...


        // --- ANIMATION MỞ (Updated Target) ---
        const modal = document.getElementById('project-modal');
        // Target mới: Wrapper chứa cả nút và content box
        const animationWrapper = document.getElementById('modal-animation-wrapper');

        modal.classList.remove('hidden');
        modal.classList.add('flex');
        document.body.style.overflow = 'hidden';

        setTimeout(() => {
            modal.classList.remove('opacity-0', 'pointer-events-none');
            // Áp dụng animation lên wrapper
            animationWrapper.classList.remove('scale-95', 'opacity-0');
            animationWrapper.classList.add('scale-100', 'opacity-100');
        }, 10);
        
        lucide.createIcons();
    }

    function renderMediaPlayer(mediaList, project) {
        const mediaSection = document.getElementById('modal-media-section');
        const mainContainer = document.getElementById('modal-main-media');
        const thumbContainer = document.getElementById('modal-thumbnails');
        
        // Reset nội dung
        mainContainer.innerHTML = '';
        thumbContainer.innerHTML = '';

        // 1. Nếu không có media: Ẩn section
        if (mediaList.length === 0) {
            mediaSection.classList.add('hidden');
            return; 
        }
        mediaSection.classList.remove('hidden');

        // --- CẤU HÌNH CLASS CONTAINER ---
        // Giữ nguyên các class quan trọng để layout Flex hoạt động với nút bấm
        thumbContainer.className = "flex-1 flex gap-3 overflow-x-auto custom-scrollbar scroll-smooth justify-start p-2"; 
        
        // 2. Hàm hiển thị Media chính
        const setMainMedia = (index) => {
            const item = mediaList[index];
            mainContainer.innerHTML = ''; 

            if (item.type === 'video') {
                const embedUrl = getYoutubeEmbedUrl(item.src);
                mainContainer.innerHTML = `
                    <iframe src="${embedUrl}?autoplay=1&rel=0" 
                            title="YouTube video player" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen
                            class="w-full h-full object-cover">
                    </iframe>`;
            } else {
                mainContainer.innerHTML = `<img src="${item.src}" class="h-full w-full object-contain" alt="Project Media">`;
            }

            // Highlight Active Thumbnail
            Array.from(thumbContainer.children).forEach((child, i) => {
                if (i === index) {
                    child.classList.remove('opacity-50', 'ring-transparent');
                    child.classList.add('opacity-100', 'ring-2', 'ring-sky-500');
                    // Tự động cuộn thumbnail được chọn vào tầm nhìn
                    child.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                } else {
                    child.classList.remove('opacity-100', 'ring-2', 'ring-sky-500');
                    child.classList.add('opacity-50', 'ring-transparent');
                }
            });
        };

        // 3. Render Thumbnails
        mediaList.forEach((media, index) => {
            const thumbBtn = document.createElement('button');
            
            // flex-shrink-0: Không cho phép co lại
            thumbBtn.className = "flex-shrink-0 w-24 h-16 bg-slate-100 rounded-lg overflow-hidden transition-all duration-200 border border-slate-200 opacity-50 hover:opacity-100";
            
            if (media.type === 'video') {
                thumbBtn.innerHTML = `<div class="w-full h-full flex items-center justify-center bg-slate-800"><i data-lucide="play-circle" class="text-white w-6 h-6"></i></div>`;
            } else {
                thumbBtn.innerHTML = `<img src="${media.src}" class="w-full h-full object-cover">`;
            }

            thumbBtn.onclick = (e) => {
                e.stopPropagation();
                setMainMedia(index);
            };
            thumbContainer.appendChild(thumbBtn);
        });

        // Chọn cái đầu tiên
        setMainMedia(0);
    }

    function scrollThumbnails(direction) {
        const container = document.getElementById('modal-thumbnails');
        if (container) {
            // Cuộn 200px mỗi lần bấm
            const scrollAmount = 200; 
            container.scrollBy({
                left: direction * scrollAmount,
                behavior: 'smooth' 
            });
        }
    }

    function closeModal() {
        const modal = document.getElementById('project-modal');
        // Target mới: Wrapper
        const animationWrapper = document.getElementById('modal-animation-wrapper');

        // --- ANIMATION ĐÓNG (Updated Target) ---
        modal.classList.add('opacity-0', 'pointer-events-none');
        // Áp dụng animation đóng lên wrapper
        animationWrapper.classList.remove('scale-100', 'opacity-100');
        animationWrapper.classList.add('scale-95', 'opacity-0');

        setTimeout(() => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            document.body.style.overflow = '';
            document.getElementById('modal-main-media').innerHTML = '';
        }, 300);
    }
</script>
</body>
</html>