<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio | Đặng Văn Thanh - Unity Game Programmer</title>
    <link rel="icon" href="ava.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f8fafc;
            color: #334155;
            -webkit-font-smoothing: antialiased;
        }

        .project-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #e2e8f0;
        }

        .project-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 20px -5px rgba(0, 0, 0, 0.08);
            border-color: #bae6fd;
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

<nav class="bg-white border-b border-slate-200 sticky top-0 z-[100]">
    <div class="max-w-6xl mx-auto px-4 h-16 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <img src="ava.png" alt="Avatar" class="w-10 h-10 rounded-lg object-cover border border-sky-700">
            <div>
                <h1 id="nav-name" class="font-bold text-slate-900 text-sm md:text-base leading-none"></h1>
                <span id="nav-title"
                      class="text-[9px] text-slate-400 font-bold tracking-[0.2em] uppercase mt-1 block"></span>
            </div>
        </div>
        <div class="flex items-center gap-6">
            <a href="index.html" target="_blank" title="My CV" class="header-link font-bold inline-flex flex-row items-center gap-2 whitespace-nowrap text-sm text-slate-500 hover:text-sky-700 transition tracking-widest uppercase">
                <span class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="svg-icon" viewBox="0 0 16 16" width="20">
                        <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm9 1.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 0-1h-4a.5.5 0 0 0-.5.5M9 8a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 0-1h-4A.5.5 0 0 0 9 8m1 2.5a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 0-1h-3a.5.5 0 0 0-.5.5m-1 2C9 10.567 7.21 9 5 9c-2.086 0-3.8 1.398-3.984 3.181A1 1 0 0 0 2 13h6.96q.04-.245.04-.5M7 6a2 2 0 1 0-4 0 2 2 0 0 0 4 0"></path>
                    </svg>
                </span>
                <span>My CV</span>
            </a>
        </div>
    </div>
</nav>

<header class="bg-white pb-10 pt-14 px-4 text-center border-b border-slate-50">
    <h2 id="hero-title" class="text-3xl font-bold text-slate-900 mb-3 tracking-tight"></h2>
    <p id="hero-subtitle" class="text-slate-500 text-sm max-w-xl mx-auto leading-relaxed"></p>
    <!--    <div class="flex flex-wrap justify-center gap-2 mt-6" id="hero-skills"></div>-->
</header>

<main id="main-content" class="max-w-6xl mx-auto px-4 py-12 w-full flex-grow space-y-16">
</main>

<footer class="bg-white border-t border-slate-200 py-8">
    <div class="max-w-6xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4">
        <p id="footer-copy" class="text-slate-400 text-[13px] tracking-widest uppercase"></p>

        <div id="footer-socials" class="flex gap-6 text-slate-400 items-center">
        </div>
    </div>
</footer>

<script src="data.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        initBasicInfo();
        renderFooterContacts();
        // renderHeroSkills();
        renderDynamicSections();
        lucide.createIcons();

        setTimeout(() => {
            initCarouselState();
        }, 100);

        if (window.location.hash) {
            const targetId = window.location.hash.substring(1);
            const element = document.getElementById(targetId);
            if (element) {
                setTimeout(() => {
                    element.scrollIntoView({behavior: 'smooth'});
                }, 100);
            }
        }

        document.querySelectorAll('.no-scrollbar').forEach(el => {
            el.style.msOverflowStyle = 'none';
            el.style.scrollbarWidth = 'none';
        });

        window.addEventListener('resize', () => {
            setTimeout(initCarouselState, 100);
        });
    });

    // 1. Điền thông tin cơ bản & Header
    function initBasicInfo() {
        document.getElementById('nav-name').textContent = cvData.fullName;
        document.getElementById('nav-title').textContent = cvData.jobTitle;

        const pfInfo = cvData.portfolioInfo || {
            title: "Danh mục dự án",
            subTitle: "Tổng hợp các sản phẩm Game Mobile và dự án nghiên cứu kỹ thuật cá nhân trong quá trình làm việc.",
            footerText: "© 2026 Đặng Văn Thanh"
        };

        document.getElementById('hero-title').textContent = pfInfo.title;
        document.getElementById('hero-subtitle').textContent = pfInfo.subTitle;
        document.getElementById('footer-copy').textContent = pfInfo.footerText;
    }

    // 2. Render Footer Icons
    function renderFooterContacts() {
        const container = document.getElementById('footer-socials');
        const c = cvData.contact;

        const socialItems = [
            {icon: 'phone', link: `tel:${c.phone}`, title: c.phone},
            {icon: 'mail', link: `mailto:${c.email}`, title: c.email},
            {icon: 'globe', link: c.website, title: c.websiteDisplay},
            {icon: 'github', link: c.github, title: c.githubDisplay},
            {
                icon: 'map-pin',
                link: `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(c.address)}`,
                title: c.address
            }
        ];

        socialItems.forEach(item => {
            if (item.link && !item.link.includes('undefined')) {
                const a = document.createElement('a');
                a.href = item.link;
                a.target = "_blank";
                a.className = "hover:text-sky-700 transition transform hover:scale-110";
                a.title = item.title;

                const i = document.createElement('i');
                i.setAttribute('data-lucide', item.icon);
                i.className = "w-5 h-5";

                a.appendChild(i);
                container.appendChild(a);
            }
        });
    }

    // 3. Render Tags kỹ năng trên Header
    function renderHeroSkills() {
        const heroSkills = document.getElementById('hero-skills');
        cvData.skills.flatMap(s => s.items).forEach(item => {
            heroSkills.innerHTML += `<span class="px-2.5 py-1 bg-slate-50 text-slate-500 text-[10px] font-bold rounded-md border border-slate-100 uppercase tracking-tighter">${item}</span>`;
        });
    }

    // 4. Hàm chính: Tự động tạo Section theo Công ty & Cá nhân
    function renderDynamicSections() {
        const mainContainer = document.getElementById('main-content');

        // B. Render Dự án cá nhân
        if (cvData.personalProjects && cvData.personalProjects.projects.length > 0) {
            const title = cvData.portfolioInfo?.personalSectionTitle || "Personal Projects";
            const sectionHtml = generateSectionHtml(
                title,
                'code-2',
                cvData.personalProjects.projects,
                false
            );
            mainContainer.insertAdjacentHTML('beforeend', sectionHtml);
        }

        // A. Render từng công ty trong Work Experience
        cvData.workExperience.forEach(work => {
            if (work.details && work.details.length > 0) {
                const sectionHtml = generateSectionHtml(
                    work.company,
                    'briefcase',
                    work.details,
                    true
                );
                mainContainer.insertAdjacentHTML('beforeend', sectionHtml);
            }
        });
    }

    // Helper: Hàm sinh HTML cho một Section
    function generateSectionHtml(title, iconName, projects, isCompany) {
        const sectionId = isCompany ? title.replace(/\s+/g, '') : "PersonalProjects";

        const cardsHtml = projects.map(proj => `
        <div class="w-[85vw] md:w-[380px] flex-shrink-0 snap-start h-full">
            ${renderCard(proj, isCompany ? title : "Personal Project", isCompany)}
        </div>
    `).join('');

        return `
        <section id="section-${sectionId}" class="scroll-mt-24 mb-12">
            <div class="flex items-center justify-between mb-0 px-1">

                <div class="flex items-center gap-3">
                    <i data-lucide="${iconName}" class="text-sky-700 w-6 h-6"></i>
                    <h3 class="text-xl font-bold text-slate-900 uppercase tracking-wider">${title}</h3>
                </div>

                <div class="flex gap-2 translate-y-[20px]">
                    <button id="btn-left-${sectionId}"
                            onclick="handleScroll('${sectionId}', -1)"
                            class="flex items-center justify-center w-10 h-10 rounded-full
                                   border border-slate-300 bg-white text-sky-700
                                   hover:bg-sky-50 hover:text-sky-700 hover:border-sky-200
                                   transition-all duration-200 shadow-md cursor-pointer"
                            style="opacity: 0.5; pointer-events: none;"> <i data-lucide="chevron-left" class="w-5 h-5"></i>
                    </button>

                    <button id="btn-right-${sectionId}"
                            onclick="handleScroll('${sectionId}', 1)"
                            class="flex items-center justify-center w-10 h-10 rounded-full
                                   border border-slate-300 bg-white text-sky-700
                                   hover:bg-sky-50 hover:text-sky-700 hover:border-sky-200
                                   transition-all duration-200 shadow-md cursor-pointer">
                        <i data-lucide="chevron-right" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>

            <div class="relative w-full group">
                <div id="container-${sectionId}"
                     onscroll="updateButtonVisibility('${sectionId}')"
                     class="flex gap-6 overflow-x-auto no-scrollbar snap-x snap-mandatory scroll-smooth px-1 py-4 w-full h-full scroll-pl-1 relative z-10">
                    ${cardsHtml}
                </div>
            </div>
        </section>
    `;
    }

    // Helper: Hàm sinh HTML cho từng Card dự án
    function renderCard(proj, subtitle, isComp) {
        const tags = proj.tags?.map(t =>
            `<span class="bg-sky-50 text-sky-700 text-[10px] font-bold px-1.5 py-0.5 rounded border border-sky-100 uppercase tracking-tighter">${t}</span>`
        ).join('') || '';

        const points = proj.points?.map(p =>
            `<li class="mb-1 text-[13px] leading-snug">${p}</li>`
        ).join('') || '';

        return `
            <div onclick="openProjectModal('${proj.name}')"
                 class="project-card bg-white rounded-xl p-6 h-full flex flex-col relative group cursor-pointer">

                <div class="absolute top-0 left-0 w-full h-1 ${isComp ? 'bg-sky-700' : 'bg-slate-400'} rounded-t-xl transition-all group-hover:h-1.5"></div>

                <div class="flex justify-between items-start mb-4">
                    <div class="p-2.5 bg-slate-50 text-slate-400 rounded-lg group-hover:bg-sky-50 group-hover:text-sky-700 transition-colors">
                        <i data-lucide="${proj.icon || (isComp ? 'gamepad-2' : 'code')}" class="w-5 h-5"></i>
                    </div>
                    <span class="text-[9px] font-bold text-slate-400 uppercase tracking-[0.15em] text-right">${subtitle}</span>
                </div>

                <h4 class="text-base font-bold text-slate-900 mb-0.5 group-hover:text-sky-700 transition-colors">
                    ${proj.name}
                </h4>
                <div class="text-[10px] text-sky-600 font-bold mb-3 italic tracking-tight uppercase">${proj.genre || ''}</div>

                <p class="text-slate-600 text-[13px] font-medium leading-relaxed mb-4 line-clamp-2">
                    ${proj.description}
                </p>

                <ul class="text-slate-500 list-disc list-outside ml-4 mb-6 flex-grow font-normal leading-snug">
                    ${points}
                </ul>

                <div class="flex flex-wrap gap-1.5 pt-4 border-t border-slate-50">
                    ${tags}
                </div>

                <div class="absolute bottom-4 right-4 text-slate-200 group-hover:text-sky-400 transition-colors">
                    <i data-lucide="maximize-2" class="w-3 h-3"></i>
                </div>
            </div>`;
    }

    // 1. Xử lý sự kiện click
    function handleScroll(id, direction) {
        const container = document.getElementById(`container-${id}`);
        if (container) {
            const scrollAmount = container.clientWidth * 0.75;
            container.scrollBy({left: direction * scrollAmount, behavior: 'smooth'});
        }
    }

    // 2. Logic Ẩn/Hiện (Chạy mỗi khi cuộn)
    // (Code này giữ nguyên từ bước trước, dán lại để đảm bảo đồng bộ)
    function updateButtonVisibility(id) {
        const container = document.getElementById(`container-${id}`);
        const btnLeft = document.getElementById(`btn-left-${id}`);
        const btnRight = document.getElementById(`btn-right-${id}`);

        if (!container || !btnLeft || !btnRight) return;

        // Nút Trái
        if (container.scrollLeft <= 10) {
            btnLeft.style.opacity = '0.5';
            btnLeft.style.pointerEvents = 'none';
            btnLeft.style.transform = 'translateY(-50%) scale(0.8)'; // Hiệu ứng thu nhỏ khi ẩn
        } else {
            btnLeft.style.opacity = '1';
            btnLeft.style.pointerEvents = 'auto';
            btnLeft.style.transform = 'translateY(-50%) scale(1)'; // Trở lại bình thường
        }

        // Nút Phải
        const scrollRight = Math.ceil(container.scrollLeft + container.clientWidth);
        const scrollWidth = Math.ceil(container.scrollWidth);

        if (scrollRight >= scrollWidth - 10) {
            btnRight.style.opacity = '0.5';
            btnRight.style.pointerEvents = 'none';
            btnRight.style.transform = 'translateY(-50%) scale(0.8)';
        } else {
            btnRight.style.opacity = '1';
            btnRight.style.pointerEvents = 'auto';
            btnRight.style.transform = 'translateY(-50%) scale(1)';
        }
    }

    // 3. Khởi tạo (Chạy 1 lần khi load trang)
    function initCarouselState() {
        const containers = document.querySelectorAll('[id^="container-"]');

        containers.forEach(container => {
            const id = container.id.replace('container-', '');

            // --- FIX QUAN TRỌNG: ÉP VỀ VỊ TRÍ 0 ---
            // Sửa lỗi trình duyệt tự nhớ vị trí cũ hoặc snap sai
            container.scrollLeft = 0;
            // -------------------------------------

            // Kiểm tra xem nội dung có đủ dài để cuộn không
            if (container.scrollWidth <= container.clientWidth + 5) {
                // Nếu ngắn quá -> Ẩn luôn nút phải
                const btnRight = document.getElementById(`btn-right-${id}`);
                if (btnRight) {
                    btnRight.style.opacity = '0';
                    btnRight.style.pointerEvents = 'none';
                }
            } else {
                // Nếu đủ dài -> Cập nhật trạng thái (lúc này nút trái sẽ ẩn vì scrollLeft = 0)
                updateButtonVisibility(id);
            }
        });
    }

    function openProjectModal(projectName) {
        console.log("Mở chi tiết dự án: " + projectName);
    }
</script>
</body>
</html>